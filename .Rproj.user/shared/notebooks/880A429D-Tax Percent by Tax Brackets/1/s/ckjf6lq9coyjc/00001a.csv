"0",""
"0","# Load required packages"
"0","library(tidyverse)"
"0","library(here)"
"0",""
"0","# Create Singles Table"
"0","singles_tax_rates <- tibble::tribble("
"0","  ~Filing.Type,      ~tax.type,    ~min,     ~max,  ~rate,"
"0","  ""Single"", ""capitalgains"",      0L,   41675L,      0,"
"0","  ""Single"", ""capitalgains"",  41676L,  459750L,   0.15,"
"0","  ""Single"", ""capitalgains"", 459751L, 9999999L,    0.2,"
"0","  ""Single"",      ""federal"",      0L,   11000L,    0.1,"
"0","  ""Single"",      ""federal"",  11000L,   44725L,   0.12,"
"0","  ""Single"",      ""federal"",  44725L,   95375L,   0.22,"
"0","  ""Single"",      ""federal"",  95375L,  182100L,   0.24,"
"0","  ""Single"",      ""federal"", 182100L,  231250L,   0.32,"
"0","  ""Single"",      ""federal"", 231250L,  578125L,   0.35,"
"0","  ""Single"",      ""federal"", 578125L, 9999999L,   0.37,"
"0","  ""Single"",        ""state"",      0L,    3750L, 0.0475,"
"0","  ""Single"",        ""state"",   3751L,    9450L, 0.0675,"
"0","  ""Single"",        ""state"",   9451L,  125000L, 0.0875,"
"0","  ""Single"",        ""state"", 125001L, 9999999L,  0.099,"
"0","  ""Single"",        ""newstate"",      0L,    3750L, 0.0475+.0075,"
"0","  ""Single"",        ""newstate"",   3751L,    9450L, 0.0675+.0075,"
"0","  ""Single"",        ""newstate"",   9451L,  125000L, 0.0875+.0075,"
"0","  ""Single"",        ""newstate"", 125001L, 9999999L,  0.099+.0075"
"0",")"
"0",""
"0","# Take the incomes of $1 to $1 million"
"0","tax_rates_for_singles <- tibble(income = 1:1000000) %>%"
"0","  cross_join("
"0","    singles_tax_rates"
"0","  ) %>%"
"0","  mutate("
"0","    # Make the tax dollars per bracket"
"0","    tax_dollars = rate*case_when("
"0","      income < min ~ 0,"
"0","      income > max ~ max-min-1,"
"0","      income >= min & income <= max ~ income-min-1"
"0","    ),"
"0","    tax_dollars = floor(tax_dollars),"
"0","    # Create new columns for each type of tax"
"0","    wages = if_else(tax.type %in% c('federal', 'state'), tax_dollars, 0),"
"0","    capital = if_else(tax.type %in% c('capitalgains', 'state'), tax_dollars, 0),"
"0","    newcapital = if_else(tax.type %in% c('capitalgains', 'newstate'), tax_dollars, 0)"
"0","  ) %>%"
"0","  # Get the total amount of taxes per type of income per an income amount"
"0","  group_by(income) %>%"
"0","  reframe("
"0","    wages = sum(wages),"
"0","    capital = sum(capital),"
"0","    newcapital = sum(newcapital)"
"0","  ) %>%"
"0","  # Turn the columns to rows to make it easier to graph"
"0","  pivot_longer(cols = c(wages, capital, newcapital), names_to = ""tax_type"", values_to = ""tax_dollars"") %>%"
"0","  mutate("
"0","    true_tax_rates = tax_dollars/income,"
"0","    tax_type = case_when("
"0","      tax_type == 'wages' ~ 'Wages',"
"0","      tax_type == 'capital' ~ 'Capital Gains',"
"0","      tax_type == 'newcapital' ~ 'New Capital Gains')"
"0","  )"
"0",""
"0","# Create graph of the rate of taxes per income"
"0","tax_graph <- tax_rates_for_singles %>%"
"0","  # Graph only the first x rows"
"0","  filter(income < 200000) %>%"
"0","  ggplot(aes(x=income, y=true_tax_rates, color=tax_type)) +"
"0","  geom_line() +"
"0","  scale_y_continuous("
"0","    labels = scales::percent_format(scale = 100)"
"0","  ) +"
"0","  scale_x_continuous(labels=scales::dollar_format()) +"
"0","  theme("
"0","    panel.background = element_blank(),"
"0","    panel.grid.major = element_blank(),"
"0","    panel.grid.minor = element_blank(),"
"0","    plot.title = element_text(size=14),"
"0","    axis.title = element_text(size=12),"
"0","    legend.key=element_blank(),"
"0","    legend.title=element_blank(),"
"0","    axis.ticks = element_blank(),"
"0","    axis.line.y = element_line(),"
"0","    axis.line.x = element_line(),"
"0","    legend.box=""vertical"","
"0","    legend.position=""right"""
"0","  ) +"
"0","  theme("
"0","    panel.grid.major.y = element_line(linetype=2),"
"0","    panel.grid = element_line(color = ""#CDD7DC"","
"0","                              size = 0.75,"
"0","                              linetype = 2)"
"0","  ) +"
"0","  ylab('Federal and State Tax Rate') +"
"0","  xlab('Income') +"
"0","  ggtitle(""Federal and State Income in Oregon"")"
"0",""
"0","print(tax_graph)"
